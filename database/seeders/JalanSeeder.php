<?php

namespace Database\Seeders;

use App\Models\Jalan;
use App\Models\ObjekPoint;
use Illuminate\Database\Seeder;

class JalanSeeder extends Seeder
{
    private function resolvePointId(string $name): int
    {
        // Alias handling: your routes use "ITS" but objekpoint uses full name
        $aliases = [
            'ITS' => 'Institut Teknologi Sepuluh Nopember',
        ];

        $tryNames = [$name];
        if (isset($aliases[$name])) {
            $tryNames[] = $aliases[$name];
        }

        foreach ($tryNames as $n) {
            $p = ObjekPoint::where('NamaObjek', $n)->first();
            if ($p) return $p->getKey();
        }

        throw new \RuntimeException("ObjekPoint not found for route endpoint: {$name}");
    }

    public function run(): void
    {
        $novotelItsCoordsJson = <<<'JSON'
[[112.77385993659088,-7.282064798131145],[112.77361670897521,-7.281822070066596],[112.77279935156944,-7.280943110711945],[112.79202028921776,-7.280135691206851],[112.79189793835695,-7.280037722245211],[112.79167479517719,-7.280019788841699],[112.79118686584167,-7.279983233251755],[112.79107784750249,-7.279870836864234],[112.79091391661404,-7.279688110167498],[112.79074292022898,-7.279498020928344],[112.79081915609123,-7.279322366901994],[112.7908132596641,-7.279161522034585],[112.79073660611402,-7.279013837151155],[112.7905877213314,-7.278942188032218],[112.79043146601407,-7.27892171685302],[112.7902191946414,-7.279031383872635],[112.79008551973135,-7.279249608096038],[112.78986292961036,-7.279289088197672],[112.78885969245613,-7.279423506896009],[112.78778488521817,-7.279572867627664],[112.78672054903677,-7.2797225223717135],[112.78561487170566,-7.27986586062913],[112.78442970675667,-7.280038986413032],[112.78311829698868,-7.280212333498085],[112.78220713754769,-7.280341412678453],[112.78114426513406,-7.280491218811775],[112.7808332286071,-7.280513152141225],[112.78082438404437,-7.2807207875096935],[112.78081159684126,-7.281425761167625],[112.78080365766743,-7.28229930011625],[112.78080365780767,-7.283094743902197],[112.78081839978495,-7.283764861593539],[112.78084493382124,-7.28486490265206],[112.78085230453433,-7.285729872385701],[112.78078333812107,-7.286654019652914],[112.78069872662354,-7.287621993177964],[112.78060572002636,-7.288652183590514],[112.78054015569228,-7.289535381216709],[112.78048122404203,-7.290358362429643],[112.7805034519186,-7.291174955297421],[112.78072106766979,-7.292253106060002],[112.78083009426928,-7.2925784992060585],[112.78112947543644,-7.2934414663954925],[112.78142178011319,-7.294391962068005],[112.78166976487432,-7.295304979434974],[112.78182520867705,-7.296054996875114],[112.78187717580573,-7.29683731632359],[112.7818774377152,-7.29758045365449],[112.78187621837361,-7.298466199807365],[112.78182315052993,-7.299347883416559],[112.78169196511811,-7.300530089597103],[112.78156961421763,-7.30155067372425],[112.78143784168145,-7.302662143939571],[112.78132818848508,-7.3036150321062365],[112.7811362675597,-7.304798903614795],[112.78099033099238,-7.305423238071711],[112.78091914529932,-7.305627248397727],[112.78059515231877,-7.3065775892408595],[112.78043629126665,-7.307242888713816],[112.78041765809036,-7.308147260774135],[112.78042911745138,-7.309151348293412],[112.78046787141307,-7.310257548966717],[112.7805277023208,-7.31133893785109],[112.78043020009989,-7.3113323440243505],[112.78011110191943,-7.3112400304405725],[112.77986513040696,-7.311200467469732],[112.77892000483752,-7.311032045979033],[112.77765912383677,-7.310779282377297],[112.77627908415502,-7.310409629257265],[112.7743644950774,-7.309855746318917],[112.77405651200183,-7.30978140788622],[112.77303938655399,-7.309517653822127],[112.77199985853053,-7.3092430965915725],[112.77085642338568,-7.308935383130361],[112.76963099773843,-7.308614481722216],[112.76961770198085,-7.308713389715436],[112.77040879955126,-7.308928789268137],[112.77104921186918,-7.309098031700628],[112.77172507954197,-7.309289253592922],[112.77253390352473,-7.3095222362768055],[112.77318318254396,-7.309698070647016],[112.77382802678238,-7.309871708687055],[112.7737792756713,-7.310029961018984]]
JSON;

        $hotelBumiItsCoordsJson = <<<'JSON'
[[112.74146626935288,-7.271795496562547],[112.7415567965408,-7.272075458268247],[112.74171655040038,-7.272086022857522],[112.74165797398462,-7.271536663887858],[112.74159939756419,-7.270945045783364],[112.74159607467874,-7.270236254047191],[112.74158808697632,-7.269810699854517],[112.74153098438757,-7.26917295312461],[112.7414495514223,-7.268597256179561],[112.74130136584893,-7.267848895184287],[112.741202446535,-7.2672390194141485],[112.74112201949129,-7.266581672632881],[112.74103149224749,-7.266068336280924],[112.74101551681133,-7.2658705298495505],[112.74101817937577,-7.265434734307533],[112.74109928601877,-7.2646094244237815],[112.74115329247172,-7.263993407936468],[112.74115861760038,-7.263848142196608],[112.74094028732515,-7.263090118388703],[112.7409376247607,-7.2629606995621],[112.74101202543017,-7.26284890717578],[112.7411158654383,-7.262790800737662],[112.74163506548388,-7.262970402432003],[112.74225278040882,-7.263184339651076],[112.74287378717668,-7.263418298360861],[112.74367788160635,-7.26374316562692],[112.74461690397209,-7.26409590937277],[112.745401197121,-7.2643972206282115],[112.7455290002099,-7.264391938243165],[112.74567544124773,-7.264344396775087],[112.74573135509911,-7.264156872047991],[112.74596632882339,-7.2632745574127995],[112.7462117534102,-7.2623868862732905],[112.74646562667692,-7.261828110605819],[112.74661017807057,-7.2613578386634],[112.74670336782134,-7.260980145426217],[112.74676460680143,-7.26082167264542],[112.74689240989034,-7.260750359875118],[112.74762461508243,-7.260964298150483],[112.74816960951495,-7.261104463903408],[112.74847846697816,-7.261220677208684],[112.74885655111302,-7.261484798244922],[112.74929587315876,-7.26181230711272],[112.74947160240436,-7.261933802649068],[112.74977513473897,-7.2623194186993345],[112.75006002912312,-7.262673339988524],[112.75025705888356,-7.262884636147589],[112.7504354506936,-7.263058955403821],[112.75068573242226,-7.263418158656876],[112.75086678679668,-7.263740384725892],[112.7510611539928,-7.2639173448463055],[112.75137001145606,-7.264075816536774],[112.75174543302654,-7.264160334748482],[112.75228060845814,-7.26419202907411],[112.7530647858847,-7.264230825000382],[112.75357067310688,-7.26428893125312],[112.75403129673822,-7.2644104261193405],[112.75437476945655,-7.264571538277494],[112.75503508541118,-7.264972999199273],[112.75549304647654,-7.265231835656635],[112.75591032022129,-7.2654776227589934],[112.75617923921925,-7.265604399675553],[112.75647212129644,-7.265688917599832],[112.75699132134196,-7.265704764708957],[112.75781937884915,-7.265723253002292],[112.7588444447793,-7.265747024972441],[112.75995473410626,-7.265791925107862],[112.76039139465689,-7.26583946642198],[112.76079355139956,-7.26586587840643],[112.76173343660957,-7.265850031303771],[112.76199836117235,-7.265881509226361],[112.76275985457232,-7.2658999975124345],[112.76310190813751,-7.265864261090897],[112.76422551028617,-7.2658510551712965],[112.76498853002482,-7.265839748367867],[112.76524679886086,-7.2658740837239435],[112.76627454869282,-7.266088019560911],[112.76745577717543,-7.266352970348493],[112.76850383238195,-7.266561974781723],[112.76947566836265,-7.266770627934974],[112.76969664507078,-7.266837340364816],[112.76997088919751,-7.266937705123638],[112.77050872719349,-7.267265211020515],[112.77114508006889,-7.267664028362617],[112.7717734440879,-7.268046998297535],[112.77210892719307,-7.268179056829723],[112.77259085133767,-7.268263574269724],[112.77352165919473,-7.268387709526365],[112.77432840883125,-7.26849335629592],[112.77422112655483,-7.269111957706812],[112.77391758992206,-7.270587116787851],[112.77365399585756,-7.2717959023917444],[112.77346229046935,-7.2727253756835495],[112.77326259593309,-7.27376975285334],[112.773090597693,-7.274612499830354],[112.77295266152657,-7.275579761986876],[112.7728195260292,-7.2766255734232175],[112.77272633627683,-7.277357163224025],[112.77261325864197,-7.278213982108525],[112.77242179392647,-7.279300733511505],[112.77228765960274,-7.28030961242132],[112.77229032246453,-7.280375639813272],[112.77236008020026,-7.28040844825226],[112.7732946402815,-7.280403166055635],[112.77482295221023,-7.280426935940113],[112.77627549028404,-7.280456886487016],[112.77844279501716,-7.280483302023967],[112.780615939347,-7.280512359856104],[112.78099727545572,-7.280509112255899],[112.78222205504989,-7.28033479977411],[112.78301978060512,-7.28022916229294],[112.78440451693763,-7.2800546594941125],[112.78565724466472,-7.279868319896352],[112.78678082755533,-7.279709859164555],[112.78823987853553,-7.279509130235951],[112.78957273420895,-7.279324262727997],[112.79002843105849,-7.279261214805132],[112.79014558389002,-7.279166135013398],[112.79025208646254,-7.279020874181143],[112.79043580341187,-7.278938999860301],[112.79055459040927,-7.278938446885363],[112.79073830734797,-7.279009756767863],[112.79081019658548,-7.2791946341866804],[112.7908208468429,-7.279376870425608],[112.79074363247668,-7.279498361210187],[112.791189622167,-7.279980370735302],[112.79190958267264,-7.280038038882978],[112.79278993265439,-7.280935282879753],[112.7933913996265,-7.281550620925572],[112.79363635554535,-7.281849064173869],[112.79386799864238,-7.282065633485971]]
JSON;

        $routes = [
            [
                'NamaJalan' => 'Novotel-ITS',
                'coords' => json_decode($novotelItsCoordsJson, true),
                'StartNamaObjek' => 'ITS',
                'EndNamaObjek' => 'NOVOTEL SAMATOR SURABAYA TIMUR',
                'DistanceKM' => 4.5,
            ],
            [
                'NamaJalan' => 'Hotel Bumi-ITS',
                'coords' => json_decode($hotelBumiItsCoordsJson, true),
                'StartNamaObjek' => 'ITS',
                'EndNamaObjek' => 'HOTEL BUMI SURABAYA',
                'DistanceKM' => 7.5,
            ],
        ];

        foreach ($routes as $r) {
            $startId = $this->resolvePointId($r['StartNamaObjek']);
            $endId   = $this->resolvePointId($r['EndNamaObjek']);

            Jalan::updateOrCreate(
                ['NamaJalan' => $r['NamaJalan']],
                [
                    'KoordinatJSON' => json_encode([
                        'type' => 'LineString',
                        'coordinates' => $r['coords']
                    ], JSON_UNESCAPED_SLASHES),
                    'StartPointID' => $startId,
                    'EndPointID' => $endId,
                    'DistanceKM' => $r['DistanceKM'],
                ]
            );
        }
    }
}
